<!DOCTYPE html>
<html>

<head>
    <title>Jewels Co.</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="templatestyle.css">
    <link rel="stylesheet" href="style.css">
    <script src="./functions.js"></script>
    <meta http-equiv="refresh" content="9999999999.5">
    <script>

        //help from prof port
        var products_array;
        loadJSON("./productData", function (response) {
            // Parsing JSON string into object
            products_array = JSON.parse(response);
        });

        var cart_array;
        loadJSON("./cartData", function (response) {
            // Parsing JSON string into object
            cart_array = JSON.parse(response);
        });

        //from lab12
        function isNonNegInt(q, returnerrors = false) {
            errors = []; // assume no errors at first
            if (q == '') {
                q = 0; // handle blank inputs as if they are 0, help from assignment 1 example
            }
            if (Number(q) != q) {
                errors.push("Not a number!"); // Check if string is a number value
            } else if (q < 0) {
                errors.push("Negative value!"); // Check if it is non-negative
            } else if (parseInt(q) != q) {
                errors.push("Not an integer!"); // Check that it is an integer
            }
            return returnerrors ? errors : (errors.length == 0);
        }

        //help from assignment 1 example
        function checkQuantityTextbox(theTextbox) {
            errs = isNonNegInt(theTextbox.value, true);
            if (errs.length == 0) errs = ['You want:'];
            if (theTextbox.value.trim() == '') errs = ['Quantity'];
            document.getElementById(theTextbox.name).innerHTML = errs.join(", ");
        }

        //help from prof port
        window.onload = function () {
            for (var i in products_array) {
                document.getElementById(`quantity${i}`).value = cart_array[i];
            }
        }


    </script>

</head>

<body>

    <!-- Navbar (sit on top) -->
    <div class="w3-top">
        <div class="w3-bar w3-white w3-wide w3-padding w3-card">
            <a href="index.html" class="w3-bar-item w3-button"><b>Jewels</b> Co.</a>
            <!-- Float links to the right. Hide them on small screens -->

            <nav id=navbar class="w3-center">
                <a href="gold.html" class="w3-bar-item w3-button">Gold</a>
                <a href="diamond.html" class="w3-bar-item w3-button">Diamond</a>
                <a href="pearl.html" class="w3-bar-item w3-button">Pearl</a>
            </nav>

            <div class="w3-right w3-hide-small">
                <div class="container w3-bar-item">
                    <img src="pics\shoppingcart.png" alt="jewelry" style="width: 25px; height: 25px;">
                    <script>
                        function getSum(total, num) {
                            return total + Math.round(num);
                        }
                        document.write(`<div id="cart" class="w3-bar-item">${cart_array.reduce(getSum, 0)}</div>`);
                    </script>
                </div>
                <a href="login.html" class="w3-bar-item w3-button">Log In</a>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="w3-display-container w3-content w3-wide" style="max-width:1500px; max-height: 1500px;" id="home">
        <img class="w3-image" src="/pics/jewl.jpg" alt="Architecture" width="3500" height="3000">
        <div class="w3-display-middle w3-margin-top w3-center">
            <h1 class="w3-xxlarge w3-text-white"><span class="w3-padding w3-black w3-opacity-min"><b>Jewels
                        Co.</b></span></h1>
        </div>
    </header>

    <!-- Page content -->
    <div class="w3-content w3-padding" style="max-width:1564px;">

        <!-- Project Section -->
        <div class="w3-container w3-padding-32" id="projects">
            <h3 class="w3-border-bottom w3-border-light-grey w3-padding-16">Products For Sale</h3>
        </div>

        <form name="product_form" action="./purchase" method="POST">
            <script>

                //function help from prof port
                function setValue(index, increment) { //change name
                    var quannum = document.getElementById("quantity" + index);
                    if (Number(quannum.value) + increment < 0) { //
                        quannum.value = Number(quannum.value);
                    } else if (Number(quannum.value) + increment > products_array[index].quantity_available) { // checks to see if it is more than avail
                        quannum.value = Number(quannum.value);
                        location.reload();
                    } else {
                        quannum.value = Number(quannum.value) + increment;
                        location.reload();
                    }

                    loadJSON(`./updateCart?pindex=${index}&qty=${quannum.value}`, function (response) {
                        // Parsing JSON string into object
                        var response = JSON.parse(response);
                    });
                }

                var productPageArray = [];

                    for (var i = 0; i < products_array.length; i++){
                        if (products_array[i]["itemNum"] == "1"){ // ---!--- need to get this to only pull certain items and add to an array via item num
                        productPageArray.push(products_array[i]);
                        }
                }   

                    // will return undefined if not found; you could return a default instead
                

                

                //displays items
                for (var i = 0; i <= products_array.length; i++) {
                    document.write(`                    
                    <div id=itembox class="w3-col">
                    <div class="w3-display-container">
                    <div class="w3-display-bottomleft w3-black w3-padding">${products_array[i].name} | x${products_array[i].quantity_available} left</div>
                    <div id="wrapper">
                    <div class="w3-display-bottomright"><button type="button" id=plus class="plus" onclick="setValue(${i},1)">+</button></div>
                    <div class="w3-display-bottomright"><button type="button" class="minus" onclick="setValue(${i},-1)">-</button></div>
                    </div>
                    <div class="w3-display-topleft w3-black w3-padding">$${products_array[i].price}</div>
                    <div id=quanbox class="quan"><input class="" type="text" id="quantity${i}" placeholder="0" name="quantity${i}" onkeyup="checkQuantityTextbox(this, ${i});"></div>
                    <img src="${products_array[i].image}" alt="jewelry" style="width:350px; height:350px; border-style: solid;">
                </div>
    </div>
    `);
                }
            </script>


            <!-- End page content -->
    </div>


    <!-- Footer -->
    <footer id="footer2" class="w3-center  w3-margin-top-space">
        <div id="submit" class="w3-bottom"><input type="submit" value="Check Out" name="purchase_submit"></div>
    </footer>

    <footer id="footer" class="w3-center w3-black w3-padding-16 w3-bottom w3-margin-top-space">
        <p>By: Jordan Cooper in ITM 352</p>
    </footer>
    </form>
</body>

</html>